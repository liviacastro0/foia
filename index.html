<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="https://github.com/liviacastro0/imgs/blob/main/logo.png?raw=true" type="image/png">
  <link rel="stylesheet" href="style.css">
  <title>Análise de Solo Agrícola - IA Especializada</title>

</head>

<body>
  <div class="container">
    <h1>Análise de Solo Agrícola Inteligente</h1>

    <form id="form-solo" onsubmit="return processarFormulario(event)">
      <div class="form-grid">
        <div class="form-group">
          <label for="nitrogenio">
            Nitrogênio (kg/ha)
            <span class="info-icon" title="Valor ideal: 20-50 kg/ha para maioria das culturas">i</span>
          </label>
          <input type="number" id="nitrogenio" name="nitrogenio" placeholder="Ex: 25" min="0" max="80" required />
          <span class="input-hint">Faixa: 0-80 kg/ha</span>
        </div>

        <div class="form-group">
          <label for="fosforo">
            Fósforo (kg/ha)
            <span class="info-icon" title="Valor ideal: 15-40 kg/ha para grãos">i</span>
          </label>
          <input type="number" id="fosforo" name="fosforo" placeholder="Ex: 15" min="0" max="80" required />
          <span class="input-hint">Faixa: 0-80 kg/ha</span>
        </div>

        <div class="form-group">
          <label for="potassio">
            Potássio (kg/ha)
            <span class="info-icon" title="Valor ideal: 40-80 kg/ha para frutíferas">i</span>
          </label>
          <input type="number" id="potassio" name="potassio" placeholder="Ex: 50" min="0" max="80" required />
          <span class="input-hint">Faixa: 0-80 kg/ha</span>
        </div>

        <div class="form-group">
          <label for="temperatura">
            Temperatura (°C)
            <span class="info-icon" title="Temperatura média anual do local">i</span>
          </label>
          <input type="number" id="temperatura" name="temperatura" placeholder="Ex: 23" min="-25" max="80" required />
          <span class="input-hint">Faixa: -25°C a 80°C</span>
        </div>

        <div class="form-group">
          <label for="umidade">
            Umidade (%)
            <span class="info-icon" title="Umidade relativa média do solo">i</span>
          </label>
          <input type="text" id="umidade" name="umidade" placeholder="Ex: 60,00" required />
          <span class="input-hint">Formato: 00,00 (0-100%)</span>
        </div>

        <div class="form-group">
          <label for="ph">
            pH do Solo
            <span class="info-icon" title="Escala de 0 (ácido) a 14 (alcalino)">i</span>
          </label>
          <input type="text" id="ph" name="ph" placeholder="Ex: 6,50" required />
          <span class="input-hint">Escala: 0 (ácido) a 14 (alcalino)</span>
        </div>
      </div>

      <div class="form-group">
        <label for="chuva">
          Precipitação (mm/mês)
          <span class="info-icon" title="Média mensal de chuva na região">i</span>
        </label>
        <input type="text" id="chuva" name="chuva" placeholder="Ex: 120,000" required />
        <span class="input-hint">Formato: 000,000</span>
      </div>

      <div class="form-group">
        <label for="regiao">
          Região/Clima
          <span class="info-icon" title="Selecione o bioma predominante">i</span>
        </label>
        <select id="regiao" name="regiao" required>
          <option value="">Selecione...</option>
          <option value="Amazônia">Amazônia</option>
          <option value="Cerrado">Cerrado</option>
          <option value="Mata Atlântica">Mata Atlântica</option>
          <option value="Caatinga">Caatinga</option>
          <option value="Pampa">Pampa</option>
          <option value="Pantanal">Pantanal</option>
        </select>
      </div>

      <div style="text-align: center; margin-top: 25px;">
        <button type="submit" id="submit-btn">
          <span id="btn-text">Analisar Solo</span>
          <span class="loading-spinner" id="spinner"></span>
        </button>
        <button type="button" id="btn-ajuda" style="background: #6c757d;">
          Ajuda com Valores
        </button>
      </div>
    </form>

    <table id="tabela-referencia">
      <thead>
        <tr>
          <th>Cultura</th>
          <th>pH Ideal</th>
          <th>N (kg/ha)</th>
          <th>P (kg/ha)</th>
          <th>K (kg/ha)</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Soja</td>
          <td>6.0-7.0</td>
          <td>20-40</td>
          <td>15-30</td>
          <td>30-60</td>
        </tr>
        <tr>
          <td>Milho</td>
          <td>5.8-7.0</td>
          <td>30-50</td>
          <td>20-40</td>
          <td>40-80</td>
        </tr>
        <tr>
          <td>Café</td>
          <td>5.5-6.5</td>
          <td>30-50</td>
          <td>20-40</td>
          <td>40-70</td>
        </tr>
        <tr>
          <td>Feijão</td>
          <td>5.8-6.5</td>
          <td>15-30</td>
          <td>10-25</td>
          <td>20-50</td>
        </tr>
      </tbody>
    </table>

    <section id="respostaIA" class="resposta-ia" aria-live="polite" hidden>
      <h2>Recomendações Personalizadas</h2>
      <div id="conteudoResposta"></div>
    </section>
  </div>

  <script>
    let dadosBiomas = {
      "Amazônia": { 
        caracteristicas: { 
          precipitacao_mm_ano: 2500,
          temperatura_media: 26
        }, 
        solos: [{ 
          textura: "argilosa", 
          aptidao: "cacau, açaí, guaraná",
          tipo: "Latossolo"
        }] 
      },
      "Cerrado": { 
        caracteristicas: { 
          precipitacao_mm_ano: 1500,
          temperatura_media: 24
        }, 
        solos: [{ 
          textura: "média", 
          aptidao: "soja, milho, algodão",
          tipo: "Latossolo vermelho"
        }] 
      },
      "Mata Atlântica": { 
        caracteristicas: { 
          precipitacao_mm_ano: 1800,
          temperatura_media: 22
        }, 
        solos: [{ 
          textura: "argilosa", 
          aptidao: "café, cana-de-açúcar, eucalipto",
          tipo: "Terra roxa"
        }] 
      },
      "Caatinga": { 
        caracteristicas: { 
          precipitacao_mm_ano: 600,
          temperatura_media: 28
        }, 
        solos: [{ 
          textura: "arenosa", 
          aptidao: "manga, uva irrigada, caju",
          tipo: "Neossolo"
        }] 
      },
      "Pampa": { 
        caracteristicas: { 
          precipitacao_mm_ano: 1200,
          temperatura_media: 18
        }, 
        solos: [{ 
          textura: "média", 
          aptidao: "arroz, trigo, soja",
          tipo: "Planossolo"
        }] 
      },
      "Pantanal": { 
        caracteristicas: { 
          precipitacao_mm_ano: 1300,
          temperatura_media: 26
        }, 
        solos: [{ 
          textura: "argilosa", 
          aptidao: "arroz, pecuária, pesca",
          tipo: "Gleissolo"
        }] 
      }
    };

    function getDadosBioma(bioma) {
      if (!bioma || !dadosBiomas[bioma]) return null;
      
      const dados = dadosBiomas[bioma];
      const soloPrincipal = dados.solos && dados.solos.length > 0 ? dados.solos[0] : {};
      
      return {
        textura: soloPrincipal.textura || 'não especificada',
        precipitacao: dados.caracteristicas?.precipitacao_mm_ano || 'não especificada',
        aptidao: soloPrincipal.aptidao || 'não especificada',
        tipoSolo: soloPrincipal.tipo || 'não especificado',
        temperatura: dados.caracteristicas?.temperatura_media || 'não especificada'
      };
    }

    function aplicarMascaraComVirgula(campoId, maxValor) {
      const campo = document.getElementById(campoId);
      campo.addEventListener('input', function() {
        let valor = campo.value.replace(',', '').replace(/[^\d]/g, '');
        if (valor.length > 2) {
          valor = valor.slice(0, valor.length - 2) + ',' + valor.slice(-2);
        }
        campo.value = valor;
        const valorConvertido = parseFloat(campo.value.replace(',', '.'));
        if (valorConvertido > maxValor) {
          campo.value = maxValor.toFixed(2).replace('.', ',');
        }
        validarCampo(campo);
      });
    }

    function mascaraChuva(campoId) {
      const campo = document.getElementById(campoId);
      campo.addEventListener('input', function() {
        let valor = campo.value.replace(/[^\d]/g, '');
        if (valor.length > 6) valor = valor.slice(0, 6);

        while (valor.length < 4) {
          valor = '0' + valor;
        }

        let parteInteira = valor.slice(0, valor.length - 3);
        let parteDecimal = valor.slice(-3);
        campo.value = `${parseInt(parteInteira)},${parteDecimal}`;
        validarCampo(campo);
      });
    }

    function limitarValor(campoId, min, max) {
      const campo = document.getElementById(campoId);
      campo.addEventListener('input', function() {
        let valor = parseInt(campo.value);
        if (isNaN(valor)) return;
        if (valor > max) campo.value = max;
        if (valor < min) campo.value = min;
        validarCampo(campo);
      });
    }

    function validarCampo(campo) {
      if (campo.value === "") {
        campo.classList.add("erro-validacao");
        campo.classList.remove("sucesso-validacao");
      } else {
        campo.classList.remove("erro-validacao");
        campo.classList.add("sucesso-validacao");
      }
    }

    function validarDadosAgricolas(dados) {
      const erros = [];
      
      if (dados.nitrogenio > 80 || dados.nitrogenio < 0) erros.push("Nitrogênio fora da faixa (0-80 kg/ha)");
      if (dados.fosforo > 80 || dados.fosforo < 0) erros.push("Fósforo fora da faixa (0-80 kg/ha)");
      if (dados.potassio > 80 || dados.potassio < 0) erros.push("Potássio fora da faixa (0-80 kg/ha)");
      if (dados.temperatura > 80 || dados.temperatura < -25) erros.push("Temperatura fora da faixa (-25°C a 80°C)");
      
      const ph = parseFloat(dados.ph.replace(',', '.'));
      if (ph < 0 || ph > 14) erros.push("pH inválido (deve estar entre 0 e 14)");
      
      const umidade = parseFloat(dados.umidade.replace(',', '.'));
      if (umidade < 0 || umidade > 100) erros.push("Umidade deve ser entre 0% e 100%");
      
      if (!dados.regiao) erros.push("Selecione uma região/clima");

      return erros;
    }

    async function processarFormulario(event) {
      event.preventDefault();

      const dados = {
        nitrogenio: parseInt(document.getElementById('nitrogenio').value),
        fosforo: parseInt(document.getElementById('fosforo').value),
        potassio: parseInt(document.getElementById('potassio').value),
        temperatura: parseInt(document.getElementById('temperatura').value),
        umidade: document.getElementById('umidade').value,
        ph: document.getElementById('ph').value,
        chuva: document.getElementById('chuva').value,
        regiao: document.getElementById('regiao').value
      };

      const erros = validarDadosAgricolas(dados);
      if (erros.length > 0) {
        alert("Erros encontrados:\n\n" + erros.join("\n"));
        return false;
      }

      document.getElementById('spinner').style.display = 'inline-block';
      document.getElementById('btn-text').textContent = 'Processando...';
      document.getElementById('submit-btn').disabled = true;

      const respostaIA = document.getElementById("respostaIA");
      const conteudoResposta = document.getElementById("conteudoResposta");
      respostaIA.hidden = false;
      conteudoResposta.innerHTML = `
        <div style="text-align:center;margin:2em 0;">
          <div class="loader" style="display:inline-block;width:40px;height:40px;border:4px solid #f3f3f3;border-top:4px solid #3498db;border-radius:50%;animation:spin 1s linear infinite;"></div>
          <p>Consultando especialista agrícola...</p>
        </div>
      `;

      // Simulamos um delay para parecer que está processando
      setTimeout(() => {
        try {
          const dadosBioma = getDadosBioma(dados.regiao) || {};
          const resposta = gerarRespostaSimulada(dados, dadosBioma);
          
          conteudoResposta.innerHTML = formatarRespostaAgricultura(resposta);

          if (dadosBioma) {
            conteudoResposta.innerHTML += `
              <div class="bioma-info">
                <h3>Características do ${dados.regiao}</h3>
                <p><strong>Textura predominante:</strong> ${dadosBioma.textura}</p>
                <p><strong>Precipitação média:</strong> ${dadosBioma.precipitacao}mm/ano</p>
                <p><strong>Temperatura média:</strong> ${dadosBioma.temperatura}°C</p>
                <p><strong>Culturas típicas:</strong> ${dadosBioma.aptidao}</p>
              </div>
            `;
          }

          conteudoResposta.innerHTML += `
            <div style="text-align:center;margin-top:2em;">
              <button id="btn-copiar" style="background:#0078D7;color:white;border:none;padding:0.5em 1em;border-radius:4px;cursor:pointer;font-size:0.9em;">
                Copiar recomendações
              </button>
            </div>
          `;

          document.getElementById('btn-copiar').addEventListener('click', function() {
            const textoParaCopiar = document.getElementById('conteudoResposta').innerText;
            navigator.clipboard.writeText(textoParaCopiar).then(() => {
              const btn = this;
              const textoOriginal = btn.textContent;
              btn.textContent = 'Copiado!';
              btn.style.background = '#28a745';
              setTimeout(() => {
                btn.textContent = textoOriginal;
                btn.style.background = '#0078D7';
              }, 2000);
            });
          });

        } catch (e) {
          conteudoResposta.innerHTML = `
            <div style="color:#b00;background:#fff3f3;padding:1em;border-radius:6px;">
              <strong>Erro ao gerar recomendações.</strong>
              <p>${e.message || 'Por favor, tente novamente.'}</p>
            </div>
          `;
          console.error(e);
        } finally {
          document.getElementById('spinner').style.display = 'none';
          document.getElementById('btn-text').textContent = 'Analisar Solo';
          document.getElementById('submit-btn').disabled = false;
        }
      }, 1500); // Delay de 1.5 segundos
    }

    function gerarRespostaSimulada(dados, dadosBioma) {
      const ph = parseFloat(dados.ph.replace(',', '.'));
      const umidade = parseFloat(dados.umidade.replace(',', '.'));
      const chuva = parseFloat(dados.chuva.replace(',', '.'));
      
      // Culturas recomendadas por região
      const culturasPorRegiao = {
        "Amazônia": {
          principal: "Cacau",
          alternativa: "Açaí",
          outras: ["Guaraná", "Pupunha"]
        },
        "Cerrado": {
          principal: "Soja",
          alternativa: "Milho",
          outras: ["Algodão", "Sorgo"]
        },
        "Mata Atlântica": {
          principal: "Café",
          alternativa: "Cana-de-açúcar",
          outras: ["Eucalipto", "Banana"]
        },
        "Caatinga": {
          principal: "Manga",
          alternativa: "Uva irrigada",
          outras: ["Caju", "Goiaba"]
        },
        "Pampa": {
          principal: "Arroz",
          alternativa: "Trigo",
          outras: ["Soja", "Pastagens"]
        },
        "Pantanal": {
          principal: "Arroz",
          alternativa: "Pecuária",
          outras: ["Piscicultura", "Capim"]
        }
      };
      
      const culturas = culturasPorRegiao[dados.regiao] || {
        principal: "Soja",
        alternativa: "Milho",
        outras: ["Feijão", "Trigo"]
      };
      
      // Recomendações baseadas nos valores
      const recomendacoes = [];
      
      // Recomendações de pH
      if (ph < 5.5) {
        recomendacoes.push("Aplicação de calcário para corrigir acidez do solo");
        recomendacoes.push(`Dose sugerida: ${Math.round((6.0 - ph) * 2000)} kg/ha de calcário dolomítico`);
      } else if (ph > 7.5) {
        recomendacoes.push("Solo alcalino, considerar aplicação de gesso agrícola");
      } else {
        recomendacoes.push("pH do solo dentro da faixa ideal para maioria das culturas");
      }
      
      // Recomendações de nutrientes
      if (dados.nitrogenio < 20) {
        recomendacoes.push(`Adubação nitrogenada recomendada: ${Math.round((30 - dados.nitrogenio) * 1.5)} kg/ha de N`);
      }
      
      if (dados.fosforo < 15) {
        recomendacoes.push(`Adubação fosfatada recomendada: ${Math.round((25 - dados.fosforo) * 1.8)} kg/ha de P2O5`);
      }
      
      if (dados.potassio < 40) {
        recomendacoes.push(`Adubação potássica recomendada: ${Math.round((60 - dados.potassio) * 1.2)} kg/ha de K2O`);
      }
      
      // Recomendações de umidade
      if (umidade < 40) {
        recomendacoes.push("Solo com baixa umidade, considerar irrigação complementar");
      } else if (umidade > 80) {
        recomendacoes.push("Solo com excesso de umidade, avaliar drenagem");
      }
      
      // Época de plantio baseada na temperatura
      let epocaPlantio = "Durante a estação chuvosa";
      if (dados.temperatura > 25) {
        epocaPlantio = "No início das chuvas (outubro/novembro)";
      } else if (dados.temperatura < 15) {
        epocaPlantio = "Na primavera (setembro/outubro)";
      }
      
      return `
      <h3>1. Diagnóstico do Solo</h3>
      <p><strong>Nutrientes:</strong></p>
      <ul>
        <li>Nitrogênio: ${dados.nitrogenio} kg/ha (${dados.nitrogenio < 20 ? 'Baixo' : 'Adequado'})</li>
        <li>Fósforo: ${dados.fosforo} kg/ha (${dados.fosforo < 15 ? 'Baixo' : 'Adequado'})</li>
        <li>Potássio: ${dados.potassio} kg/ha (${dados.potassio < 40 ? 'Baixo' : 'Adequado'})</li>
      </ul>
      
      <p><strong>Características físicas:</strong></p>
      <ul>
        <li>pH: ${dados.ph} (${ph < 5.5 ? 'Ácido' : ph > 7.5 ? 'Alcalino' : 'Ideal'})</li>
        <li>Umidade: ${dados.umidade}% (${umidade < 40 ? 'Baixa' : umidade > 80 ? 'Alta' : 'Adequada'})</li>
        <li>Precipitação: ${dados.chuva} mm/mês</li>
        <li>Temperatura: ${dados.temperatura}°C</li>
      </ul>
      
      <h3>2. Recomendações Agrícolas</h3>
      <p><strong>Culturas recomendadas para ${dados.regiao}:</strong></p>
      <ul>
        <li>Principal: ${culturas.principal}</li>
        <li>Alternativa: ${culturas.alternativa}</li>
        <li>Outras opções: ${culturas.outras.join(', ')}</li>
      </ul>
      
      <p><strong>Época ideal de plantio:</strong> ${epocaPlantio}</p>
      
      <h3>3. Manejo e Correções</h3>
      <ul>
        ${recomendacoes.map(rec => `<li>${rec}</li>`).join('')}
      </ul>
      
      <h3>4. Adubação Orgânica</h3>
      <p>Recomenda-se aplicação de 5-10 ton/ha de composto orgânico para melhorar a estrutura do solo.</p>
      `;
    }

    function formatarRespostaAgricultura(texto) {
      // Remove markdown simples e formata parágrafos
      texto = texto.replace(/\*\*/g, '')
                   .replace(/#{1,6}/g, '')
                   .replace(/`/g, '')
                   .replace(/\n\n/g, '</p><p>')
                   .replace(/\n/g, '<br>');
      
      return `<div>${texto}</div>`;
    }

    document.addEventListener('DOMContentLoaded', function() {
      // Inicializa as máscaras e validações
      aplicarMascaraComVirgula('umidade', 100);
      aplicarMascaraComVirgula('ph', 14);
      mascaraChuva('chuva');

      limitarValor('nitrogenio', 0, 80);
      limitarValor('fosforo', 0, 80);
      limitarValor('potassio', 0, 80);
      limitarValor('temperatura', -25, 80);

      // Validação ao sair do campo
      document.querySelectorAll('input, select').forEach(input => {
        input.addEventListener('blur', function() {
          validarCampo(this);
        });
      });

      // Botão de ajuda
      document.getElementById('btn-ajuda').addEventListener('click', function() {
        const tabela = document.getElementById('tabela-referencia');
        tabela.style.display = tabela.style.display === 'none' ? 'table' : 'none';
      });

      // Mostra informações do bioma selecionado
      document.getElementById('regiao').addEventListener('change', function() {
        const biomaSelecionado = this.value;
        const dados = getDadosBioma(biomaSelecionado);
        
        if (dados) {
          console.log(`Bioma selecionado: ${biomaSelecionado}`, dados);
        }
      });
    });
  </script>
</body>
</html>